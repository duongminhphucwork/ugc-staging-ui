<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>T·∫°o Prompt Staging</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f4f4f4;
      padding: 30px;
      color: #333;
    }
    h2 {
      margin-bottom: 20px;
    }
    label {
      display: block;
      margin: 12px 0 6px;
    }
    input, button, textarea {
      font-size: 16px;
      padding: 10px;
      width: 100%;
      box-sizing: border-box;
    }
    button {
      background: #3b82f6;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      margin-top: 16px;
    }
    button:hover {
      background: #2563eb;
    }
    #preview {
      margin-top: 20px;
      max-width: 300px;
      border-radius: 6px;
    }
    #result {
      margin-top: 30px;
      background: white;
      padding: 20px;
      border-radius: 6px;
      border: 1px solid #ccc;
      white-space: pre-wrap;
    }
  </style>
</head>
<body>

  <h2>‚ú® T·∫°o Prompt Staging t·ª´ ·∫¢nh UGC</h2>

  <label for="imageInput">üñºÔ∏è Upload ·∫£nh s·∫£n ph·∫©m</label>
  <input type="file" id="imageInput" accept="image/*" />

  <label for="productName">üìù T√™n s·∫£n ph·∫©m</label>
  <input type="text" id="productName" placeholder="Nh·∫≠p t√™n s·∫£n ph·∫©m..." />

  <button onclick="submitToN8N()">üîÅ T·∫°o Prompt</button>

  <img id="preview" src="" alt="" style="display:none;" />

  <div id="result"></div>

  <script>
    let base64Image = "";

    document.getElementById("imageInput").addEventListener("change", function(event) {
      const file = event.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onloadend = function () {
        base64Image = reader.result.split(',')[1]; // B·ªè prefix data:image/...
        document.getElementById("preview").src = reader.result;
        document.getElementById("preview").style.display = "block";
      };
      reader.readAsDataURL(file);
    });

    async function submitToN8N() {
      const productName = document.getElementById("productName").value.trim();
      const resultBox = document.getElementById("result");

      if (!base64Image || !productName) {
        alert("Vui l√≤ng ch·ªçn ·∫£nh v√† nh·∫≠p t√™n s·∫£n ph·∫©m!");
        return;
      }

      resultBox.innerHTML = "‚è≥ ƒêang g·ª≠i d·ªØ li·ªáu t·ªõi n8n...";

      try {
        const res = await fetch("https://coldbrewecom.app.n8n.cloud/webhook-test/4a8f414c-14ff-4688-b607-631d71fee781", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            productName: productName,
            imageBase64: base64Image
          })
        });

        const data = await res.json();
        if (data.prompt) {
          resultBox.innerHTML = `‚úÖ Prompt GPT tr·∫£ v·ªÅ:\n\n${data.prompt}`;
        } else {
          resultBox.innerHTML = "‚ùå Kh√¥ng nh·∫≠n ƒë∆∞·ª£c prompt t·ª´ server.";
        }

      } catch (err) {
        resultBox.innerHTML = "üö´ G·ª≠i d·ªØ li·ªáu th·∫•t b·∫°i: " + err.message;
      }
    }
  </script>

</body>
</html>
