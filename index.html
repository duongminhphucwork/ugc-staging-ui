<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>T·∫°o Prompt Staging</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f4f4f4;
      padding: 30px;
      color: #333;
    }
    h2 {
      margin-bottom: 20px;
    }
    label {
      display: block;
      margin: 12px 0 6px;
    }
    input, button, textarea {
      font-size: 16px;
      padding: 10px;
      width: 100%;
      box-sizing: border-box;
    }
    button {
      border: none;
      cursor: pointer;
    }
    #preview {
      margin-top: 20px;
      max-width: 300px;
      border-radius: 6px;
    }
    #result {
      margin-top: 30px;
      background: white;
      padding: 20px;
      border-radius: 6px;
      border: 1px solid #ccc;
      white-space: pre-wrap;
      word-break: break-word;
    }
    #result-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    #copyBtn {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: none;
      border: none;
      cursor: pointer;
      padding: 0;
      gap: 6px;
    }

    .copy-icon-wrapper {
      background-color: #f1f1f1;
      border-radius: 8px;
      padding: 8px;
    }

    #copyBtn span {
      background-color: black;
      color: white;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 500;
    }
  </style>
</head>
<body>

  <h2>‚ú® T·∫°o Prompt Staging t·ª´ ·∫¢nh UGC</h2>

  <label for="imageInput">üñºÔ∏è Upload ·∫£nh s·∫£n ph·∫©m</label>
  <input type="file" id="imageInput" accept="image/*" />

  <label for="productName">üìù T√™n s·∫£n ph·∫©m</label>
  <input type="text" id="productName" placeholder="Nh·∫≠p t√™n s·∫£n ph·∫©m..." />

  <button style="background: #3b82f6; color: white; border-radius: 6px; margin-top: 16px;" onclick="submitToN8N()">üîÅ T·∫°o Prompt</button>

  <img id="preview" src="" alt="Preview" style="display:none;" />

  <div id="result" style="display:none;">
    <div id="result-header">
      <strong>‚úÖ Prompt tr·∫£ v·ªÅ:</strong>
      <button id="copyBtn" onclick="copyPrompt()" aria-label="Copy Prompt">
        <div class="copy-icon-wrapper">
          <svg xmlns="http://www.w3.org/2000/svg" height="20" width="20" viewBox="0 0 24 24" fill="#333">
            <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v16h14c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 18H8V7h11v16z"/>
          </svg>
        </div>
        <span>Copy</span>
      </button>
    </div>
    <div id="promptText"></div>
  </div>

  <script>
    let base64Image = "";
    let latestPrompt = "";

    document.getElementById("imageInput").addEventListener("change", function(event) {
      const file = event.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onloadend = function () {
        base64Image = reader.result.split(',')[1];
        document.getElementById("preview").src = reader.result;
        document.getElementById("preview").style.display = "block";
      };
      reader.readAsDataURL(file);
    });

    async function submitToN8N() {
      const productName = document.getElementById("productName").value.trim();
      const resultBox = document.getElementById("result");
      const promptText = document.getElementById("promptText");

      if (!base64Image || !productName) {
        alert("Vui l√≤ng ch·ªçn ·∫£nh v√† nh·∫≠p t√™n s·∫£n ph·∫©m!");
        return;
      }

      promptText.textContent = "‚è≥ ƒêang t·∫°o prompt...";
      resultBox.style.display = "block";

      try {
        const res = await fetch("https://coldbrewecom.app.n8n.cloud/webhook/4a8f414c-14ff-4688-b607-631d71fee781", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            productName: productName,
            imageBase64: base64Image
          })
        });

        const data = await res.json();
        if (data.prompt) {
          latestPrompt = data.prompt;
          promptText.textContent = data.prompt;
        } else {
          promptText.textContent = "‚ùå Kh√¥ng nh·∫≠n ƒë∆∞·ª£c prompt t·ª´ server.";
        }

      } catch (err) {
        promptText.textContent = "üö´ L·ªói: " + err.message;
      }
    }

    function copyPrompt() {
      navigator.clipboard.writeText(latestPrompt).then(() => {
        const span = document.querySelector("#copyBtn span");
        const originalText = span.innerText;
        span.innerText = "‚úì Copied!";
        setTimeout(() => {
          span.innerText = originalText;
        }, 2000);
      });
    }
  </script>

</body>
</html>
