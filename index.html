<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>T·∫°o Prompt Staging</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f4f4f4;
      padding: 30px;
      color: #333;
    }

    h2 {
      margin-bottom: 20px;
    }

    label {
      display: block;
      margin: 12px 0 6px;
    }

    input, button, textarea {
      font-size: 16px;
      padding: 10px;
      width: 100%;
      box-sizing: border-box;
    }

    #preview {
      margin-top: 20px;
      max-width: 300px;
      border-radius: 6px;
    }

    #result {
      margin-top: 30px;
      background: white;
      padding: 20px;
      border-radius: 6px;
      border: 1px solid #ccc;
      white-space: pre-wrap;
      word-break: break-word;
    }

    #result-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    #copyBtn {
      background: transparent;
      border: none;
      padding: 6px;
      border-radius: 6px;
      transition: background-color 0.2s ease;
      cursor: pointer;
    }

    #copyBtn:hover {
      background-color: #e5e7eb;
    }

    #copyBtn svg {
      stroke: #555;
    }

    button.primary {
      background: #3b82f6;
      color: white;
      border: none;
      border-radius: 6px;
      margin-top: 16px;
      cursor: pointer;
      font-weight: 500;
    }

    button.primary:hover {
      background: #2563eb;
    }
  </style>
</head>
<body>

  <h2>‚ú® T·∫°o Prompt Staging t·ª´ ·∫¢nh UGC</h2>

  <label for="imageInput">üñºÔ∏è Upload ·∫£nh s·∫£n ph·∫©m</label>
  <input type="file" id="imageInput" accept="image/*" />

  <label for="productName">üìù T√™n s·∫£n ph·∫©m</label>
  <input type="text" id="productName" placeholder="Nh·∫≠p t√™n s·∫£n ph·∫©m..." />

  <button class="primary" onclick="submitToN8N()">üîÅ T·∫°o Prompt</button>

  <img id="preview" src="" alt="Preview" style="display:none;" />

  <div id="result" style="display:none;">
    <div id="result-header">
      <strong>‚úÖ Prompt tr·∫£ v·ªÅ:</strong>
      <button id="copyBtn" onclick="copyPrompt()" title="Copy Prompt">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
          <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
        </svg>
      </button>
    </div>
    <div id="promptText"></div>
  </div>

  <script>
    let base64Image = "";
    let latestPrompt = "";

    document.getElementById("imageInput").addEventListener("change", function(event) {
      const file = event.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onloadend = function () {
        base64Image = reader.result.split(',')[1];
        document.getElementById("preview").src = reader.result;
        document.getElementById("preview").style.display = "block";
      };
      reader.readAsDataURL(file);
    });

    async function submitToN8N() {
      const productName = document.getElementById("productName").value.trim();
      const resultBox = document.getElementById("result");
      const promptText = document.getElementById("promptText");

      if (!base64Image || !productName) {
        alert("Vui l√≤ng ch·ªçn ·∫£nh v√† nh·∫≠p t√™n s·∫£n ph·∫©m!");
        return;
      }

      promptText.textContent = "‚è≥ ƒêang t·∫°o prompt...";
      resultBox.style.display = "block";

      try {
        const res = await fetch("https://coldbrewecom.app.n8n.cloud/webhook/4a8f414c-14ff-4688-b607-631d71fee781", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            productName: productName,
            imageBase64: base64Image
          })
        });

        const data = await res.json();
        if (data.prompt) {
          latestPrompt = data.prompt;
          promptText.textContent = data.prompt;
        } else {
          promptText.textContent = "‚ùå Kh√¥ng nh·∫≠n ƒë∆∞·ª£c prompt t·ª´ server.";
        }

      } catch (err) {
        promptText.textContent = "üö´ L·ªói: " + err.message;
      }
    }

    function copyPrompt() {
      navigator.clipboard.writeText(latestPrompt).then(() => {
        const btn = document.getElementById("copyBtn");
        btn.title = "‚úì Copied!";
        setTimeout(() => {
          btn.title = "Copy Prompt";
        }, 2000);
      });
    }
  </script>

</body>
</html>
